<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus">


<title data-react-helmet="true">Scripting | Certify The Web Docs</title>

<meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"><meta data-react-helmet="true" property="og:title" content="Certify The Web Docs"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" name="description" content="# About Scripting"><meta data-react-helmet="true" property="og:description" content="# About Scripting"><meta data-react-helmet="true" property="og:url" content="https://docs.certifytheweb.com/docs/script-hooks">

<link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico">


<link rel="stylesheet" href="/styles.bf6750b6.css">


<link rel="preload" href="/styles.5fff5b5c.js" as="script">

<link rel="preload" href="/runtime~main.2183b836.js" as="script">

<link rel="preload" href="/main.deb28cb4.js" as="script">

<link rel="preload" href="/1.34ffacd0.js" as="script">

<link rel="preload" href="/2.cc2d5197.js" as="script">

<link rel="preload" href="/31.1d34200d.js" as="script">

<link rel="preload" href="/20ac7829.1f1cc3f2.js" as="script">

<link rel="preload" href="/17896441.12164747.js" as="script">

<link rel="preload" href="/76a007c1.e072cb7d.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Certify The Web Logo"><strong class="navbar__title">Certify The Web - Docs</strong></a><a class="navbar__item navbar__link" href="/docs/intro">Getting Started</a><a class="navbar__item navbar__link" href="/docs/certificate-process">Requesting a Certificate</a><a class="navbar__item navbar__link" href="/docs/faq">FAQ</a><a class="navbar__item navbar__link" href="/docs/support">Support</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://community.certifytheweb.com">Community</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="Certify The Web Logo"><strong class="navbar__title">Certify The Web - Docs</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/certificate-process">Requesting a Certificate</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/faq">FAQ</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/support">Support</a></li><li class="menu__list-item"><a class="menu__link" target="_blank" rel="noopener noreferrer" href="https://community.certifytheweb.com">Community</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="sidebarLogo_3ono"><img src="/img/logo.svg" alt="Certify The Web Logo"><strong>Certify The Web - Docs</strong></div><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Introduction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/letsencrypt">What is Let&#x27;s Encrypt?</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/certificate-process">Requesting a Certificate</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/ui-options">Guide to UI Options</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/renewals">Certificate Renewals</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Guides</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/dns-validation">About DNS Validation (dns-01)</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/http-validation">About HTTP Validation (http-01)</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/script-hooks">Scripting</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Useful Info</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/ssl-windows">Using Certificates in Windows</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/commandline">Command Line (CLI) Options</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/csv-import">CSV Bulk Import via Command Line</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/backgroundservice">Background Service</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Support</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/faq">Frequently Asked Questions</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/support">Support Options</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Scripting</h1></header><div class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="about-scripting"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#about-scripting" title="Direct link to heading">#</a>About Scripting</h1><p>Certify is extensible via PowerShell scripts which can be configured to run before or after the Certificate Request (check <code>Show Advanced Options</code> and open the <code>Scripting</code> tab). The scripts are provided a parameter <code>$result</code> which contains the status and details of the managed certificate being requested. You can execute any commands including creating new processes, or using other command line tools.</p><p>A common use for scripting is to use your new certificate for services other than IIS websites, such as Microsoft Exchange, RDP Gateway, FTP servers and other services.</p><p><strong>Note: Before v4, the app is 32-bit as is the PowerShell process. See the 64-bit wrapper example below to run 64-bit commands (a common issue if a command is not found). From v4 onwards the PowerShell process is 64-bit.</strong></p><p><em>By default the background service runs as Local System, so your scripts will execute in that context</em>, this can be important for issues regarding permissions, file system encryption etc. </p><p><strong>Do not store scripts under the C:\Program Files\CertifyTheWeb* folder. File stored there will be deleted next time you update the app</strong></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="scripting-basics"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#scripting-basics" title="Direct link to heading">#</a>Scripting Basics</h2><p>Here is a sample PowerShell script which demonstrates a few commonly accessed pieces of information:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-PowerShell codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)   # required to access the $result parameter</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># either $true or $false</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$result.IsSuccess</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># object containing all information Certify has about the saved Site</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$result.ManagedItem</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># the IIS (or other service) site ID</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$result.ManagedItem.ServerSiteId   # ex: 1, 2, 3, ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># the website root directory (if applicable)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$result.ManagedItem.RequestConfig.WebsiteRootPath   # ex: &quot;C:\inetpub\wwwroot&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># the path to the created/renewed certificate PFX file</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$result.ManagedItem.CertificatePath   # ex: &quot;C:\ProgramData\Certify\certes\assets\pfx\00f9e07e-83ca-4029-a173-4b704ee78996.pfx&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># the certificate thumbprint</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$result.ManagedItem.CertificateThumbprintHash # ex: &quot;78b1080a1bf5e7fc0bbb0c0614fc4a18932db5f9&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># the previous certificate thumbprint</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$result.ManagedItem.CertificatePreviousThumbprintHash  # ex: &quot;18c1060a1be5e6fc0bbb0c0614fc4a18932db5fa&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># You can set $result.Abort to $true in a pre-request hook to prevent the certificate from</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># being requested (has no effect in post-request hooks)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$result.Abort = $false</span></div></code></pre></div><p>The <code>$result.ManagedItem</code> object is an instance of the <a href="https://github.com/webprofusion/certify/blob/development/src/Certify.Models/Config/ManagedCertificate.cs" target="_blank">ManagedCertificate</a> class, so all of the properties it has will be available in your script:</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="pre-request-script-hooks"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#pre-request-script-hooks" title="Direct link to heading">#</a>Pre-Request Script Hooks</h2><p>Notes: Pre-request scripts are executed immediately before the Certificate Request is about to be made (including the challenge file configuration checks).</p><ul><li>The <code>$result.IsSuccess</code> value will always be <code>$false</code>.</li><li>If for some reason your script would like to prevent the Certificate Request from being executed, you may set <code>$result.Abort</code> to <code>$true</code> and the site your script was executed for will be skipped.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="example-update-iis-site-root-directory-dynamically"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#example-update-iis-site-root-directory-dynamically" title="Direct link to heading">#</a>Example: Update IIS site root directory dynamically</h3><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-PowerShell codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$id = $result.ManagedItem.GroupId</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$domain = $result.ManagedItem.RequestConfig.PrimaryDomain</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[xml]$xml = . &quot;$env:windir\system32\inetsrv\appcmd&quot; list config /section:system.applicationHost/sites</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$path = $xml.SelectSingleNode(&quot;//site[@id=$id]/application[@path=&#x27;/&#x27;]/virtualDirectory/@physicalPath&quot;).Value</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$result.ManagedItem.RequestConfig.WebsiteRootPath = $path</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">write-output &quot;Updated Path [$domain]: $path&quot;</span></div></code></pre></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="post-request-script-hooks"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#post-request-script-hooks" title="Direct link to heading">#</a>Post-Request Script Hooks</h2><p>Notes: Post-request scripts are executed immediately after the Certificate Request was completed, whether or not the request was successful and the certificate was automatically installed and configured according to the site configuration within Certify.</p><ul><li>The <code>$result.IsSuccess</code> value indicates whether or not the Certificate Request was successfully completed.</li><li>The <code>$result.Message</code> value provides a message describing the reason for failure, or a message indicating success</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="example-output-the-result-properties-to-a-text-file"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#example-output-the-result-properties-to-a-text-file" title="Direct link to heading">#</a>Example: Output the result properties to a text file</h3><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-PowerShell codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Logs results to the given path (modify as required)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$logpath = &quot;c:\temp\ps-test.txt&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$date = Get-Date</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Add-Content $logpath (&quot;-------------------------------------------------&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Add-Content $logpath (&quot;Script Run Date: &quot; + $date)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Add-Content $logpath ($result | ConvertTo-Json)</span></div></code></pre></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="example-copy-the-pfx-file-to-a-central-certificate-store-ccs-as-a-given-user-for-multiple-domains"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#example-copy-the-pfx-file-to-a-central-certificate-store-ccs-as-a-given-user-for-multiple-domains" title="Direct link to heading">#</a>Example: Copy the PFX file to a Central Certificate Store (CCS) as a given user, for multiple domains</h3><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-PowerShell codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain"># example script to copy the output PFX to a UNC path for Central Certificate Store</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Enabling CCS: https://techcommunity.microsoft.com/t5/iis-support-blog/central-certificate-store-ccs-with-iis/ba-p/377274</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$result = Get-Content -Raw -Path C:\temp\ps-test.json | ConvertFrom-Json</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$ccsPath=&quot;\\myserver\ccs&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">if ($result.IsSuccess -eq $true) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    # connect network share with credentials</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    net use $ccsPath /USER:myserver\ccsuser password1</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    # example file copy where cert contains webmail.example.com and autodiscover.example.com domains</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Copy-Item -Path $result.ManagedItem.CertificatePath -Destination $ccsPath\webmail.example.com.pfx -Force</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Copy-Item -Path $result.ManagedItem.CertificatePath -Destination $ccsPath\autodiscover.example.com.pfx -Force</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    # disconnect network share</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    net use $ccsPath /delete</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></code></pre></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="example-export-certificate-using-openssl-to-pemcrtkey-etc-for-apache-and-other-services"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#example-export-certificate-using-openssl-to-pemcrtkey-etc-for-apache-and-other-services" title="Direct link to heading">#</a>Example: Export certificate using OpenSSL to pem,crt,key etc for Apache (and other services)</h3><p>Many services such as Apache, nginx and some mail servers etc work with certificates as pem or other formats. These generally need you to export the certificate and related public and private keys. The easiest way to do this is to install OpenSSL then use that to convert your PFX format certificate.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-PowerShell codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># script example adapted from https://community.certifytheweb.com/t/filezilla-server-ps-script/141/8</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Alias to your OpenSSL install</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">set-alias opensslcmd &quot;C:\Tools\OpenSSL\openssl.exe&quot; </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Set paths to where keys will be saved. </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># This will vary depending on your required configuration. File name are not that important but your config must point to the same filenames.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$keypath = &quot;C:\apache\conf\mydomain.com\&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$key = $keypath + &quot;cert.key&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$rsakey = $keypath + &quot;cert_rsa.key&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$pem = $keypath + &quot;cert.pem&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Get the latest PFX file path</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$sourcepfx = $result.ManagedItem.CertificatePath</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Create the Key, RSA Key, and PEM file. Use the RSA Key &amp; PEM for FileZilla</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opensslcmd pkcs12 -in $sourcepfx -out $key -nocerts -nodes -passin pass:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opensslcmd rsa -in $key -out $rsakey</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">opensslcmd pkcs12 -in $sourcepfx -out $pem -nokeys -clcerts -passin pass:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># optional: restart the Apache service (example)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Restart-Service -Name Apache2.4 -Force</span></div></code></pre></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="example-send-email-via-gmail-after-unsuccessful-renewal"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#example-send-email-via-gmail-after-unsuccessful-renewal" title="Direct link to heading">#</a>Example: Send email via Gmail after unsuccessful renewal</h3><p><em>Note: this is an example only, by default the app will use the certifytheweb.com API to notify you of repeated failures.</em></p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-PowerShell codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">if (!$result.IsSuccess) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   $EmailFrom = &quot;username@gmail.com&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   $EmailTo = &quot;username@gmail.com&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   $Subject = &quot;Cert Request Failed: &quot; + $result.ManagedItem.RequestConfig.PrimaryDomain</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   $Body = &quot;Error: &quot; + $result.Message</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   $SMTPServer = &quot;smtp.gmail.com&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   $SMTPClient = New-Object Net.Mail.SmtpClient($SmtpServer, 587)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   $SMTPClient.EnableSsl = $true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   $SMTPClient.Credentials = New-Object System.Net.NetworkCredential(&quot;username@gmail.com&quot;, &quot;password&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   $SMTPClient.Send($EmailFrom, $EmailTo, $Subject, $Body)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   write-output &quot;Sent notification email&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></code></pre></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="example-restart-rras-after-successful-certificate-renewal"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#example-restart-rras-after-successful-certificate-renewal" title="Direct link to heading">#</a>Example: Restart RRAS after successful certificate renewal</h3><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-PowerShell codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">if ($result.IsSuccess -and $result.ManagedItem.GroupId -eq 1) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   write-output &quot;Restarting RRAS...&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   Net Stop RemoteAccess</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   Net Start RemoteAccess</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   write-output &quot;Done&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></code></pre></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="example-convert-cng-certificate-storage-to-csp-for-exchange-2013"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#example-convert-cng-certificate-storage-to-csp-for-exchange-2013" title="Direct link to heading">#</a>Example: Convert CNG certificate storage to CSP (for Exchange 2013)</h3><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-PowerShell codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$tempfile = &quot;$env:TEMP\CertifyTemp.pfx&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$pfx = get-pfxcertificate -filepath $result.ManagedItem.CertificatePath</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">certutil -f -p Certify -exportpfx $pfx.SerialNumber $tempfile</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">certutil -delstore my $pfx.SerialNumber</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">certutil -p Certify -csp &quot;Microsoft RSA SChannel Cryptographic Provider&quot; -importpfx $tempfile</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">remove-item $tempfile</span></div></code></pre></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="example-enable-certificate-for-exchange-2013--2016-services-on-local-server"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#example-enable-certificate-for-exchange-2013--2016-services-on-local-server" title="Direct link to heading">#</a>Example: Enable certificate for Exchange 2013 / 2016 services on local server</h3><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-PowerShell codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Enable-ExchangeCertificate -Thumbprint $result.ManagedItem.CertificateThumbprintHash -Services POP,IMAP,SMTP,IIS -Force</span></div></code></pre></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="example-update-remote-desktop-role-certificates"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#example-update-remote-desktop-role-certificates" title="Direct link to heading">#</a>Example: update Remote Desktop Role Certificates</h3><p>This example assumes it&#x27;s starting in a 32-bit instance and switches to the 64-bit powershell to import the 64-bit RemoteDesktop module. V4.x onwards of the app is 64-bit only.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-PowerShell codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">set-alias ps64 &quot;$env:windir\sysnative\WindowsPowerShell\v1.0\powershell.exe&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ps64 -args $result -command {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   $result = $args[0]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   $pfxpath = $result.ManagedItem.CertificatePath</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   Import-Module RemoteDesktop</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   Set-RDCertificate -Role RDPublishing -ImportPath $pfxpath -Force</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   Set-RDCertificate -Role RDWebAcces -ImportPath $pfxpath -Force</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   Set-RDCertificate -Role RDGateway -ImportPath $pfxpath -Force</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   Set-RDCertificate -Role RDRedirector -ImportPath $pfxpath -Force</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></code></pre></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="example-update-vmware-horizon-certificate"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#example-update-vmware-horizon-certificate" title="Direct link to heading">#</a>Example: Update VMWare Horizon certificate</h3><p>This example removes any previous certificate with the same FriendlyName (<code>vdm</code>) then renames the Friendly Name property of the new certificate to <code>vmd</code>. It then restarts the <code>wstunnel</code> service.</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-PowerShell codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">if ($result.IsSuccess) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   $thumbprint = $result.ManagedItem.CertificateThumbprintHash # e.g. 2c127d49b4f63d947dd7b91750c9e57751eced0c</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   # remove the old cert (by Friendly Name &#x27;vdm&#x27;) to avoid duplication, if it exists</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   Get-ChildItem -Path cert:\LocalMachine\My | Where {$_.FriendlyName.Equals(&quot;vdm&quot;)} | Remove-Item</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   # rename our new certificate</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   $cert = Get-ChildItem -Path cert:\LocalMachine\My$thumbprint</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   $cert.FriendlyName =&quot;vdm&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   # restart the wstunnel service to apply certificate</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   Restart-Service wstunnel -Force -ErrorAction Stop</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></code></pre></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="example-update-certificate-for-sstp-vpn"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#example-update-certificate-for-sstp-vpn" title="Direct link to heading">#</a>Example: Update certificate for SSTP VPN</h4><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-PowerShell codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Store certificate in variable</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$cert = Get-ChildItem -Path Cert:\LocalMachine\My | Where-Object {$_.Thumbprint -match $result.ManagedItem.CertificateThumbprintHash}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"># Stop RRAS, set cert, start RRAS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Import-Module RemoteAccess</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Stop-Service RemoteAccess</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Set-RemoteAccess -SslCertificate $cert</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Start-Service RemoteAccess</span></div></code></pre></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="troubleshooting"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#troubleshooting" title="Direct link to heading">#</a>Troubleshooting</h2><ul><li>In the Certify UI, you may test scripts by clicking the &quot;Test&quot; button after entering the script filename for the hook you would like to test. This currently runs as your user account whereas the real renewal script will happen as Local System.</li><li>For a testing pre-request script, the <code>$result.IsSuccess</code> value will be <code>$false</code>, and for a post-request script the value will be <code>$true</code>.</li><li>The <code>$result.ManagedItem.CertificatePath</code> value will be set to the filename (including path) of the PFX file containing the requested certificate, unless the site is new and has not had a successful Certificate Request, in which case the value will not be set.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="using-64-bit-modules"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#using-64-bit-modules" title="Direct link to heading">#</a>Using 64-bit modules</h3><p>If you attempt to import a module with <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/import-module?view=powershell-5.1"><code>Import-Module</code></a> that does not run in 32-bit mode (i.e. RemoteDesktop), you may receive an error like <code>&quot;Import-Module : The specified module &#x27;RemoteDesktop&#x27; was not loaded because no valid module file was found in any module directory.&quot;</code>. To load a 64-bit module you can use this snippet to pass the <code>$result</code> object to a script running in 64-bit powershell:</p><div class="mdxCodeBlock_iHAB"><pre class="prism-code language-powershell codeBlock_19pQ"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><code class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">param($result)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">set-alias ps64 &quot;$env:windir\sysnative\WindowsPowerShell\v1.0\powershell.exe&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ps64 -args $result -command {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   $result = $args[0]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   write-output $result.IsSuccess</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   import-module -name RemoteDesktop</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   Set-RDCertificate ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></code></pre></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/webprofusion/certify-docs/edit/master/docs/script-hooks.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/http-validation"><h5 class="pagination-nav__link--sublabel">Previous</h5><h4 class="pagination-nav__link--label">« About HTTP Validation (http-01)</h4></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/ssl-windows"><h5 class="pagination-nav__link--sublabel">Next</h5><h4 class="pagination-nav__link--label">Using Certificates in Windows »</h4></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#scripting-basics" class="contents__link">Scripting Basics</a></li><li><a href="#pre-request-script-hooks" class="contents__link">Pre-Request Script Hooks</a><ul><li><a href="#example-update-iis-site-root-directory-dynamically" class="contents__link">Example: Update IIS site root directory dynamically</a></li></ul></li><li><a href="#post-request-script-hooks" class="contents__link">Post-Request Script Hooks</a><ul><li><a href="#example-output-the-result-properties-to-a-text-file" class="contents__link">Example: Output the result properties to a text file</a></li><li><a href="#example-copy-the-pfx-file-to-a-central-certificate-store-ccs-as-a-given-user-for-multiple-domains" class="contents__link">Example: Copy the PFX file to a Central Certificate Store (CCS) as a given user, for multiple domains</a></li><li><a href="#example-export-certificate-using-openssl-to-pemcrtkey-etc-for-apache-and-other-services" class="contents__link">Example: Export certificate using OpenSSL to pem,crt,key etc for Apache (and other services)</a></li><li><a href="#example-send-email-via-gmail-after-unsuccessful-renewal" class="contents__link">Example: Send email via Gmail after unsuccessful renewal</a></li><li><a href="#example-restart-rras-after-successful-certificate-renewal" class="contents__link">Example: Restart RRAS after successful certificate renewal</a></li><li><a href="#example-convert-cng-certificate-storage-to-csp-for-exchange-2013" class="contents__link">Example: Convert CNG certificate storage to CSP (for Exchange 2013)</a></li><li><a href="#example-enable-certificate-for-exchange-2013--2016-services-on-local-server" class="contents__link">Example: Enable certificate for Exchange 2013 / 2016 services on local server</a></li><li><a href="#example-update-remote-desktop-role-certificates" class="contents__link">Example: update Remote Desktop Role Certificates</a></li><li><a href="#example-update-vmware-horizon-certificate" class="contents__link">Example: Update VMWare Horizon certificate</a></li></ul></li><li><a href="#troubleshooting" class="contents__link">Troubleshooting</a><ul><li><a href="#using-64-bit-modules" class="contents__link">Using 64-bit modules</a></li></ul></li></ul></div></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/certificate-process">Requesting a Certificate</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/faq">FAQ</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/support">Support</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://community.certifytheweb.com">Discussions</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://github.com/webprofusion/certify">GitHub</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://github.com/webprofusion/certify">GitHub</a></li><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://twitter.com/certifytheweb">Twitter</a></li></ul></div></div><div class="text--center"><div>Copyright © 2020 Webprofusion Pty Ltd. Docs Built with Docusaurus.</div></div></div></footer>
</div>

<script src="/styles.5fff5b5c.js"></script>

<script src="/runtime~main.2183b836.js"></script>

<script src="/main.deb28cb4.js"></script>

<script src="/1.34ffacd0.js"></script>

<script src="/2.cc2d5197.js"></script>

<script src="/31.1d34200d.js"></script>

<script src="/20ac7829.1f1cc3f2.js"></script>

<script src="/17896441.12164747.js"></script>

<script src="/76a007c1.e072cb7d.js"></script>


</body>
</html>