(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{162:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return o})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return u}));var r=n(1),a=n(9),i=(n(0),n(166)),c={id:"dns-azuredns",title:"Using Azure DNS"},o={id:"dns-azuredns",title:"Using Azure DNS",description:"*Azure DNS documentation originally written by: Tony Johncock @Tony1044*",source:"@site/docs/dns-azuredns.md",permalink:"/docs/dns-azuredns",editUrl:"https://github.com/webprofusion/certify-docs/edit/master/docs/dns-azuredns.md"},l=[{value:"Step 1 \u2013 Install and configure Azure PowerShell",id:"step-1--install-and-configure-azure-powershell",children:[]},{value:"Step 2 \u2013 Connect to Azure PS and create the Azure Service Principal and Enterprise Application",id:"step-2--connect-to-azure-ps-and-create-the-azure-service-principal-and-enterprise-application",children:[]},{value:"3 - Grant the Application rights to update DNS",id:"3---grant-the-application-rights-to-update-dns",children:[]},{value:"4 - Create Service Principal Secret",id:"4---create-service-principal-secret",children:[]},{value:"5 \u2013 Retrieve Tenant ID and Subscription ID",id:"5--retrieve-tenant-id-and-subscription-id",children:[]},{value:"6 \u2013 Configure Credentials in Certify SSL Manager",id:"6--configure-credentials-in-certify-ssl-manager",children:[]}],p={rightToc:l};function u(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(i.b)("wrapper",Object(r.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"Azure DNS documentation originally written by: Tony Johncock @Tony1044")),Object(i.b)("p",null,"*Note: If you have not yet selected a DNS API provider to host your domain with be aware that Azure DNS is currently amongst the most complex to configure for API access. You should also note that ",Object(i.b)("strong",{parentName:"p"},"Azure Client Secrets can expire, causing your renewals to fail until you replace the key.*")),Object(i.b)("h2",{id:"step-1--install-and-configure-azure-powershell"},"Step 1 \u2013 Install and configure Azure PowerShell"),Object(i.b)("p",null,"Follow the instructions here: ",Object(i.b)("a",Object(r.a)({parentName:"p"},{href:"https://docs.microsoft.com/en-us/powershell/azure/install-azurerm-ps?view=azurermps-5.7.0"}),"https://docs.microsoft.com/en-us/powershell/azure/install-azurerm-ps?view=azurermps-5.7.0")),Object(i.b)("h2",{id:"step-2--connect-to-azure-ps-and-create-the-azure-service-principal-and-enterprise-application"},"Step 2 \u2013 Connect to Azure PS and create the Azure Service Principal and Enterprise Application"),Object(i.b)("p",null,"From PowerShell:"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-powershell"}),"# Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser\n# Import-Module Az.Accounts\nPS C:\\Users\\Tony> Connect-AzAccount\n")),Object(i.b)("p",null,"This will launch a web dialog to log into your Azure tenant. Ensure you connect with an account with the relevant administrative credentials in the portal."),Object(i.b)("p",null,"Pop your password and MFA requirements in as required when prompted."),Object(i.b)("p",null,"Once connected, create the Application and Service Principal\nRun the following script:"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-powershell"}),'$azurePassword = ConvertTo-SecureString "your secure password" -AsPlainText -Force\n\n# Import-Module Az.Resources\n$credentials = New-Object Microsoft.Azure.Commands.ActiveDirectory.PSADPasswordCredential -Property @{ StartDate=Get-Date; EndDate=Get-Date -Year 2024; Password=$azurePassword}\n$MyServicePrincipal = New-AzADServicePrincipal -DisplayName "LetsEncrypt" -PasswordCredential $credentials\n')),Object(i.b)("p",null,"Once this has successfully run, you need to retrieve the ApplicationID:"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-powershell"}),"Get-AzADApplication | Select-Object displayname, objectid, applicationid\n")),Object(i.b)("p",null,"It returns something like the following:"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{}),"DisplayName    ObjectId                             ApplicationId                       \n-----------    --------                             -------------                       \nLetsEncrypt    7f64adcf-xxxx-yyyy-zzzz-aabbccddeeff aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee\n")),Object(i.b)("p",null,"Make a note of the ApplicationID"),Object(i.b)("p",null,"This will have created a service principal and an underlying Azure application."),Object(i.b)("h2",{id:"3---grant-the-application-rights-to-update-dns"},"3 - Grant the Application rights to update DNS"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Login to portal.azure.com from a web browser"),Object(i.b)("li",{parentName:"ul"},"Click on your DNS Zone"),Object(i.b)("li",{parentName:"ul"},"Click on Access Control (IAM)"),Object(i.b)("li",{parentName:"ul"},"Click on (+) Add"),Object(i.b)("li",{parentName:"ul"},"Select:",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Role: DNS Zone Contributor"),Object(i.b)("li",{parentName:"ul"},"Assign access to: Azure AD user, group or application"),Object(i.b)("li",{parentName:"ul"},"Select: Type in LetsEncrypt"),Object(i.b)("li",{parentName:"ul"},"Click Save")))),Object(i.b)("h2",{id:"4---create-service-principal-secret"},"4 - Create Service Principal Secret"),Object(i.b)("p",null,"From the Azure portal, click Azure Active Directory:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Click App Registrations"),Object(i.b)("li",{parentName:"ul"},"Click LetsEncrypt"),Object(i.b)("li",{parentName:"ul"},"Click Certificates & secrets"),Object(i.b)("li",{parentName:"ul"},"Click Client secrets"),Object(i.b)("li",{parentName:"ul"},"Click New client secret"),Object(i.b)("li",{parentName:"ul"},"Type a key description, choose when it will expire (or never \u2013 your choice) and click save.")),Object(i.b)("p",null,Object(i.b)("em",{parentName:"p"},"IMPORTANT: The secret is only shown at this point. Copy it as once it\u2019s hidden there is NO way to retrieve it")),Object(i.b)("h2",{id:"5--retrieve-tenant-id-and-subscription-id"},"5 \u2013 Retrieve Tenant ID and Subscription ID"),Object(i.b)("p",null,"There are any number of ways to get the tenant ID, but since we\u2019re already in PowerShell:"),Object(i.b)("pre",null,Object(i.b)("code",Object(r.a)({parentName:"pre"},{className:"language-powershell"}),"Get-AzSubscription\n\nName                     Id                                   TenantId                             State  \n----                     --                                   --------                             -----  \nSubscription Name        xxxxxxxx-yyyy-zzzz-aaaa-bbbbbbbbbbbb zzzzzzzz-wwww-yyyy-aaaa-bbbbbbbbbbbb Enabled\n")),Object(i.b)("h2",{id:"6--configure-credentials-in-certify-ssl-manager"},"6 \u2013 Configure Credentials in Certify SSL Manager"),Object(i.b)("p",null,"You now have all the information you require to configure Azure settings in the app. "),Object(i.b)("p",null,"You can add this is a new Stored Credential under Settings or while you are editing a Managed Certificate, under Authorization > DNS. "),Object(i.b)("p",null,'When using the credential as part of DNS validation in the app you will be prompted for the "Zone Id", for Azure DNS this is the DNS zone name, usually in the form of "yourdomain.com"'))}u.isMDXComponent=!0},166:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return m}));var r=n(0),a=n.n(r);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=a.a.createContext({}),u=function(e){var t=a.a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):o({},t,{},e)),n},s=function(e){var t=u(e.components);return a.a.createElement(p.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},d=Object(r.forwardRef)((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,c=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),s=u(n),d=r,m=s["".concat(c,".").concat(d)]||s[d]||b[d]||i;return n?a.a.createElement(m,o({ref:t},p,{components:n})):a.a.createElement(m,o({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,c=new Array(i);c[0]=d;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o.mdxType="string"==typeof e?e:r,c[1]=o;for(var p=2;p<i;p++)c[p]=n[p];return a.a.createElement.apply(null,c)}return a.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);